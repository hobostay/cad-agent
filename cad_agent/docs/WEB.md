# CAD Agent - Web ç•Œé¢ä½¿ç”¨æŒ‡å—

> å¯è§†åŒ–æ™ºèƒ½ CAD è®¾è®¡å¹³å°

## å¯åŠ¨ Web ç•Œé¢

### æ–¹å¼ 1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬

```bash
./start_web.sh
```

### æ–¹å¼ 2ï¼šç›´æ¥è¿è¡Œ

```bash
streamlit run web_app.py
```

### è®¿é—®åœ°å€

```
http://localhost:8501
```

## ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ğŸ¤– CAD Agent - æ™ºèƒ½æœºæ¢°è®¾è®¡å¹³å°                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å·¦ä¾§æ               â”‚              ä¸»å†…å®¹åŒº                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âš™ï¸ é…ç½®          â”‚â”‚  â”‚  ğŸ“ å‚æ•°é…ç½®                   â”‚ â”‚
â”‚  â”‚  ğŸ”‘ API é…ç½®     â”‚â”‚  â”‚  æ¨¡æ•°: [2] é½¿æ•°: [20]          â”‚ â”‚
â”‚  â”‚  ğŸ“„ è¾“å‡ºæ ¼å¼     â”‚â”‚  â”‚  [ğŸš€ ç”Ÿæˆ CAD]                â”‚ â”‚
â”‚  â”‚                  â”‚â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚  ğŸ§  é›¶ä»¶é€‰æ‹©     â”‚â”‚                                      â”‚
â”‚  â”‚  [åŸºç¡€é›¶ä»¶]      â”‚â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [ä¼ åŠ¨é›¶ä»¶]      â”‚â”‚  â”‚  ğŸ¨ ç”Ÿæˆç»“æœ                   â”‚ â”‚
â”‚  â”‚  [æ”¯æ’‘é›¶ä»¶]      â”‚â”‚  â”‚  âœ… ç”ŸæˆæˆåŠŸï¼                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚  ğŸ“¥ ä¸‹è½½ gear_output.stl      â”‚ â”‚
â”‚                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä½¿ç”¨æµç¨‹

### 1. é…ç½® APIï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦ LLM æ™ºèƒ½è§£æï¼Œåœ¨å·¦ä¾§æ é…ç½® APIï¼š

- API Key
- Base URL
- æ¨¡å‹åç§°

æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®ã€‚

### 2. é€‰æ‹©é›¶ä»¶ç±»å‹

**åŸºç¡€é›¶ä»¶**
- åº•æ¿ (Plate)
- èºæ “ (Bolt)
- èºæ¯ (Nut)
- å«åœˆ (Washer)

**ä¼ åŠ¨é›¶ä»¶**
- é½¿è½® (Gear)
- ä¼ åŠ¨è½´ (Shaft)
- é˜¶æ¢¯è½´ (Stepped Shaft)
- è”è½´å™¨ (Coupling)
- çš®å¸¦è½® (Pulley)
- é“¾è½® (Sprocket)

**æ”¯æ’‘é›¶ä»¶**
- è½´æ‰¿ (Bearing)
- æ³•å…° (Flange)
- æ”¯æ¶ (Bracket)
- å¼¹ç°§ (Spring)
- è½¦æ¶ (Chassis Frame)

### 3. é…ç½®å‚æ•°

é€‰æ‹©é›¶ä»¶ç±»å‹åï¼Œä¸»ç•Œé¢ä¼šæ˜¾ç¤ºå‚æ•°é…ç½®è¡¨å•ã€‚

#### é½¿è½®å‚æ•°ç¤ºä¾‹

```
æ¨¡æ•°: 2 mm
é½¿æ•°: 20
å‹åŠ›è§’: 20Â°
åšåº¦: 10 mm
â””â”€ è½®æ¯‚å‚æ•° (å±•å¼€)
    - ä¸­å¿ƒå­”ç›´å¾„: 10 mm
    - è½®æ¯‚ç›´å¾„: 25 mm
    - è½®æ¯‚å®½åº¦: 8 mm
```

#### é˜¶æ¢¯è½´å‚æ•°ç¤ºä¾‹

```
æ®µæ•°: 3
æ®µ 1: ç›´å¾„ 30 mm, é•¿åº¦ 40 mm
æ®µ 2: ç›´å¾„ 25 mm, é•¿åº¦ 60 mm
æ®µ 3: ç›´å¾„ 20 mm, é•¿åº¦ 30 mm
```

### 4. é€‰æ‹©è¾“å‡ºæ ¼å¼

åœ¨å·¦ä¾§æ é€‰æ‹©ï¼š
- **3D STL** - ç”¨äº 3D æ‰“å°ã€å»ºæ¨¡è½¯ä»¶ï¼ˆæ¨èï¼‰
- **2D DXF** - ç”¨äºå·¥ç¨‹å›¾çº¸ã€æ¿€å…‰åˆ‡å‰²

### 5. ç”Ÿæˆ CAD

ç‚¹å‡» **"ğŸš€ ç”Ÿæˆ CAD"** æŒ‰é’®ã€‚

### 6. ä¸‹è½½æ–‡ä»¶

ç‚¹å‡» **"ğŸ“¥ ä¸‹è½½æ–‡ä»¶"** æŒ‰é’®ä¿å­˜åˆ°æœ¬åœ°ã€‚

## å¿«é€Ÿç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šç”Ÿæˆæ±½è½¦é½¿è½®

1. ç‚¹å‡» **"é½¿è½® (Gear)"**
2. é…ç½®å‚æ•°ï¼š
   - æ¨¡æ•°: 2
   - é½¿æ•°: 20
   - åšåº¦: 10
   - ä¸­å¿ƒå­”ç›´å¾„: 10
3. ç‚¹å‡» **"ğŸš€ ç”Ÿæˆ CAD"**
4. ç‚¹å‡» **"ğŸ“¥ ä¸‹è½½"**

### ç¤ºä¾‹ 2ï¼šç”Ÿæˆé˜¶æ¢¯è½´

1. ç‚¹å‡» **"é˜¶æ¢¯è½´ (Stepped Shaft)"**
2. é…ç½®å‚æ•°ï¼š
   - æ®µæ•°: 3
   - æ®µ1: ç›´å¾„ 30, é•¿åº¦ 40
   - æ®µ2: ç›´å¾„ 25, é•¿åº¦ 60
   - æ®µ3: ç›´å¾„ 20, é•¿åº¦ 30
3. ç‚¹å‡» **"ğŸš€ ç”Ÿæˆ CAD"**
4. ä¸‹è½½ STL æ–‡ä»¶

### ç¤ºä¾‹ 3ï¼šç”Ÿæˆæ±½è½¦åº•ç›˜

1. ç‚¹å‡» **"è½¦æ¶ (Chassis Frame)"**
2. é…ç½®å‚æ•°ï¼š
   - é•¿åº¦: 2500
   - å®½åº¦: 800
   - çºµæ¢é«˜åº¦: 100
   - çºµæ¢åšåº¦: 5
   - æ¨ªæ¢æ•°é‡: 5
3. ç‚¹å‡» **"ğŸš€ ç”Ÿæˆ CAD"**
4. ä¸‹è½½ 3D æ¨¡å‹

## é«˜çº§åŠŸèƒ½

### API æœåŠ¡

Web ç•Œé¢å†…ç½® REST API æœåŠ¡ï¼Œæ”¯æŒå¼€å‘è€…é›†æˆ CAD Agent åˆ°è‡ªå·±çš„åº”ç”¨ä¸­ã€‚

#### å¯åŠ¨ API æœåŠ¡

```bash
# å¯åŠ¨ API æœåŠ¡
python3 app.py

# æœåŠ¡è¿è¡Œåœ¨
# http://localhost:8000
```

#### ä¸»è¦ API ç«¯ç‚¹

**1. ç”Ÿæˆ CAD æ–‡ä»¶**

```bash
POST /api/generate
```

è¯·æ±‚ç¤ºä¾‹ï¼š
```python
import requests

# ç”Ÿæˆ 3D STL æ–‡ä»¶
response = requests.post('http://localhost:8000/api/generate', json={
    "part_type": "gear",
    "parameters": {
        "module": 2,
        "teeth": 20,
        "thickness": 10,
        "bore_diameter": 10
    },
    "output_format": "stl"  # æˆ– "dxf"
})

result = response.json()
print(result)
# {
#   "success": true,
#   "filename": "gear_output.stl",
#   "size": 63488,
#   "format": "stl"
# }
```

**2. è‡ªç„¶è¯­è¨€è§£æ**

```bash
POST /api/parse
```

```python
# è§£æè‡ªç„¶è¯­è¨€ä¸º CAD å‚æ•°
response = requests.post('http://localhost:8000/api/parse', json={
    "text": "è®¾è®¡ä¸€ä¸ªæ¨¡æ•°2ã€é½¿æ•°20çš„é½¿è½®"
})

result = response.json()
# {
#   "success": true,
#   "data": {
#     "type": "gear",
#     "parameters": {"module": 2, "teeth": 20, ...}
#   },
#   "reasoning": "è§£æè¯´æ˜..."
# }
```

**3. è·å–æ”¯æŒçš„é›¶ä»¶ç±»å‹**

```bash
GET /api/part-types
```

```python
response = requests.get('http://localhost:8000/api/part-types')
types = response.json()
# {
#   "categories": {
#     "åŸºç¡€é›¶ä»¶": ["plate", "bolt", "nut", "washer"],
#     "ä¼ åŠ¨é›¶ä»¶": ["gear", "shaft", "stepped_shaft", ...],
#     ...
#   }
# }
```

**4. éªŒè¯è®¾è®¡**

```bash
POST /api/validate
```

```python
response = requests.post('http://localhost:8000/api/validate', json={
    "part_type": "gear",
    "parameters": {
        "module": 2,
        "teeth": 20
    }
})

result = response.json()
# {
#   "success": true,
#   "valid": true,
#   "messages": ["è®¾è®¡åˆç†"],
#   "recommendations": ["å»ºè®®ææ–™: 45å·é’¢"]
# }
```

**5. ä¸‹è½½ç”Ÿæˆçš„æ–‡ä»¶**

```bash
GET /api/download/{filename}
```

```python
# ä¸‹è½½æ–‡ä»¶
import requests

response = requests.get('http://localhost:8000/api/download/gear_output.stl')
with open('my_gear.stl', 'wb') as f:
    f.write(response.content)
```

#### å®Œæ•´ç¤ºä¾‹

```python
import requests
import json

API_BASE = "http://localhost:8000"

# 1. æŸ¥è¯¢æ”¯æŒçš„é›¶ä»¶ç±»å‹
types = requests.get(f"{API_BASE}/api/part-types").json()
print("æ”¯æŒçš„é›¶ä»¶:", types)

# 2. è§£æè‡ªç„¶è¯­è¨€éœ€æ±‚
text = "è®¾è®¡ä¸€ä¸ªæ¨¡æ•°2ã€é½¿æ•°24çš„ç›´é½¿è½®"
parse_result = requests.post(f"{API_BASE}/api/parse", json={"text": text}).json()

if parse_result["success"]:
    spec = parse_result["data"]
    print("è§£æç»“æœ:", spec)

    # 3. éªŒè¯è®¾è®¡
    validation = requests.post(f"{API_BASE}/api/validate", json={
        "part_type": spec["type"],
        "parameters": spec["parameters"]
    }).json()

    print("éªŒè¯ç»“æœ:", validation)

    # 4. ç”Ÿæˆ CAD æ–‡ä»¶
    if validation["valid"]:
        generate_result = requests.post(f"{API_BASE}/api/generate", json={
            "part_type": spec["type"],
            "parameters": spec["parameters"],
            "output_format": "stl"
        }).json()

        if generate_result["success"]:
            filename = generate_result["filename"]
            # 5. ä¸‹è½½æ–‡ä»¶
            file_response = requests.get(f"{API_BASE}/api/download/{filename}")
            with open(filename, 'wb') as f:
                f.write(file_response.content)
            print(f"âœ… æ–‡ä»¶å·²ä¿å­˜: {filename}")
```

#### åœ¨çº¿ API æ–‡æ¡£

è®¿é—® http://localhost:8000/docs æŸ¥çœ‹å®Œæ•´çš„äº¤äº’å¼ API æ–‡æ¡£ï¼ˆSwagger UIï¼‰ã€‚

æ”¯æŒåœ¨çº¿æµ‹è¯•æ‰€æœ‰ API ç«¯ç‚¹ã€‚

### éªŒè¯åŠŸèƒ½

ç³»ç»Ÿè‡ªåŠ¨è¿›è¡Œå·¥ç¨‹éªŒè¯ï¼š
- å‚æ•°åˆç†æ€§æ£€æŸ¥
- æ ‡å‡†ä»¶è§„æ ¼éªŒè¯
- ä¼ åŠ¨ç³»ç»ŸåŒ¹é…æ€§

## æ•…éšœæ’é™¤

### ç«¯å£è¢«å ç”¨

**ç—‡çŠ¶**ï¼š`Port 8501 is already in use`

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# åœæ­¢ç°æœ‰æœåŠ¡
pkill -f streamlit

# é‡æ–°å¯åŠ¨
streamlit run web_app.py
```

### æµè§ˆå™¨æ— æ³•è®¿é—®

**ç—‡çŠ¶**ï¼šæ— æ³•æ‰“å¼€ localhost:8501

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œï¼š
```bash
ps aux | grep streamlit
```

2. å°è¯•å…¶ä»–ç«¯å£ï¼š
```bash
streamlit run web_app.py --server.port 8502
```

### ç”Ÿæˆå¤±è´¥

**ç—‡çŠ¶**ï¼šç”Ÿæˆå¤±è´¥æˆ–å‚æ•°é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥å‚æ•°æ˜¯å¦åˆç†
- æ¨¡æ•°æ˜¯å¦ä¸ºæ ‡å‡†å€¼ï¼ˆ1, 1.5, 2, 2.5, 3...ï¼‰
- é½¿æ•°æ˜¯å¦ â‰¥ 17
- å°ºå¯¸æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…

## ç§»åŠ¨ç«¯è®¿é—®

### å±€åŸŸç½‘è®¿é—®

1. æŸ¥çœ‹æœ¬æœº IPï¼š
```bash
ifconfig | grep "inet "
```

2. å¯åŠ¨æœåŠ¡æ—¶ç»‘å®šæ‰€æœ‰åœ°å€ï¼š
```bash
streamlit run web_app.py --server.address 0.0.0.0
```

3. åœ¨æ‰‹æœº/å¹³æ¿æµè§ˆå™¨è®¿é—®ï¼š
```
http://<æœ¬æœº IP>:8501
```

**ç¤ºä¾‹**ï¼šå¦‚æœæœ¬æœº IP æ˜¯ `192.0.2.100`ï¼Œåˆ™è®¿é—®ï¼š
```
http://192.0.2.100:8501
```

**æ³¨æ„**ï¼š
- `192.0.2.x` æ˜¯ RFC 5737 è§„å®šçš„æ–‡æ¡£ç¤ºä¾‹ IP æ®µ
- å®é™…ä½¿ç”¨æ—¶è¯·æ›¿æ¢ä¸ºçœŸå®çš„æœ¬æœº IP
- å¸¸è§æœ¬åœ° IP æ ¼å¼ï¼š`192.168.x.x`ã€`10.x.x.x`ã€`172.16.x.x`

## æœåŠ¡ç®¡ç†

### åœæ­¢æœåŠ¡

æŒ‰ `Ctrl+C` æˆ–ï¼š
```bash
pkill -f streamlit
```

### é‡å¯æœåŠ¡

```bash
# åœæ­¢
pkill -f streamlit

# å¯åŠ¨
streamlit run web_app.py
```

### åå°è¿è¡Œ

```bash
# åå°è¿è¡Œ
nohup streamlit run web_app.py > web.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f web.log
```

## æ›´å¤šèµ„æº

- [å¿«é€Ÿå¼€å§‹](QUICKSTART.md)
- [å®Œæ•´ä½¿ç”¨æŒ‡å—](GUIDE.md)
- [3D æ‰“å°æŒ‡å—](3D.md)
